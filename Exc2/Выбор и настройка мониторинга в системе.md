# Мотивация
Система мониторинга необходима для раннего выявления проблем в бизнес-критичных системах от которых зависит работоспособность и платежеспособность компании.
Компания «Александрит» производит на заказ ювелирные украшения принимая заказы онлайн и фишка компании в том, что пользователь может самостоятельно разработать дизайн украшения. Соответственно система онлайн-магазина, CRM и MES-система стали для компании бизнес-критичными системами.
Данные системы должны функционаировать безотказно и обеспечивая все функции заложенные в них, т.к. бизнес не хочет терять заказы из-за потенциальных сбоев, наступление которых можно будет заметить заранее
и вовремя принять меры, если будет корректно настроен мониторинг. Компания развивается, без мониторинга невозможно найти узкие места в системе, которые скажутся при росте количества пользователей на работе системы.

# Выбор подхода к мониторингу
Для RabbitMQ, S3 хранилище, баз данных PostgreSQL будет испоьзоваться подход мониторинга USE, т.к. он лучше показывает степень нагруженности сервиса.
Для сервисов SHOP API, CRM API, MES API будет использоваться мониторинг RED, т.к. этот подход наиболее прост, интуитивно понятен и ориентирован на мониторинг качества с точки зрения пользователя.


# Метрики
USE:
- Memory Utilisation for SHOP DB instance - процент использования ОЗУ на сервере с SHOP DB
- Memory Utilisation for CRM DB instance - процент использования ОЗУ на сервере с CRM DB
- Memory Utilisation for MES DB instance - процент использования ОЗУ на сервере с MES DB
- CPU % for SHOP API - процент загрузки процессора контейнера SHOP API
- CPU % for CRM API - процент загрузки процессора контейнера CRM API
- CPU % for MES API - процент загрузки процессора контейнера MES API
- Size of SHOP DB instance - сколько места занимает база данных SHOP DB на диске
- Size of CRM DB instance - сколько места занимает база данных CRM DB на диске
- Size of MES DB instance - сколько места занимает база данных MES db на диске
- Size of S3 storage - размер хранилища файлов 3D моделей
- Failed query for SHOP DB instance - количество неуспешных запросов к SHOP DB
- Failed query for CRM DB instance - количество неуспешных запросов к CRM DB
- Failed query for MES DB instance - количество неуспешных запросов к MES DB
- Number of dead-letter-exchange letters in RabbitMQ - количество "мертвых" сообщений, повторная публикация сообщений на бирже из-за различных ошибок
- Number of message in flight in RabbitMQ - количество сообщений в очереди RabbitMQ ожидающих обработки

RED:
- Number of requests (RPS) for internet SHOP API - количество запросов в секунду для SHOP API
- Number of requests (RPS) for CRM API - количество запросов в секунду для CRM API
- Number of requests (RPS) for MES API - количество запросов в секунду для MES API
- Number of HTTP 500 for SHOP API - количество фатальных ошибок, произошедших при обращении к SHOP API
- Number of HTTP 500 for CRM API - количество фатальных ошибок, произошедших при обращении к CRM API
- Number of HTTP 500 for MES API - количество фатальных ошибок, произошедших при обращении к MES API
- Response time (latency) for SHOP API - длительность обработки запроса к SHOP API
- Response time (latency) for CRM API - длительность обработки запроса к CRM API
- Response time (latency) for MES API - длительность обработки запроса к MES API


# План действий
1. Развернуть Prometheus
2. Развернуть Grafana
3. Добавить в компоненты системы поддержку метрик
4. Настроить в Prometheus сбор метрик с компонентов системы
5. Настроить дашборды и алерты в Grafana
6. Определить пороговые значения для насыщенности
7. Настроить автоматические уведомления и алерты
